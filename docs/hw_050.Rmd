---
title: 'Домашнее задание 5.'
date: 'Июнь, 14, 2018'
output:
  html_document:
    keep_md: no
    number_sections: yes
    toc: yes
lang: ru-RU
editor_options:
  chunk_output_type: console
---

В пятой домашке мы выясним, от чего зависит количество рабочих часов у замужних женщин.
Для этого будем использовать набор данных `Workinghours` из пакета `Ecdat`.
Прежде чем переходить к упражнениям, посмотрите описание переменных в справке :)

* Упражнение 0.

Запустите следующие чанки кода :)

Для чего нужен первый из них?

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(tidyverse) # обработка данных, графики...
library(skimr) # описательные статистики
library(rio) # импорт фантастического количества форматов данных
library(broom) # метла превращает результаты оценивания моделей в таблички
library(GGally) # больше готовых графиков
library(sjPlot) # ещё больше графиков
library(lmtest) # диагностика линейных моделей
library(Ecdat) # много-много разных наборов данных
library(sjstats) # удобные мелкие функции для работы с моделями
library(sandwich) # оценка Var для гетероскедастичности
library(AER) # работа с инструментальными переменными
```

* Упражнение 1.

Бросьте взгляд на данные `Workinghours` и посмотрите описательные статистики по ним.

```{r}
work <- Workinghours
skim(___)
glimpse(___)
```

Все ли переменные имеют правильный тип?

Исправьте недоразумения по переменным, отвечающим за расу, владение домом и наличие ипотеки, и посмотрите, что в новых данных `work_fct` все типы указаны правильно.

```{r}
work_fct <- work %>%
  mutate_at(vars(___, ___, ___), ___)
glimpse(___)
```

* Упражнение 2.

Постройте парную регрессию количества рабочих часов женщины на доход её семьи. 
Для этого и следующих заданий используйте исправленные данные `work_fct`.

```{r}
model_r <- lm(data = ___, ___ ~ ___)
summary(___)
```

- Какое p-значение у коэффициента при переменной `income`?

- Найдите значение F-статистики для проверки гипотезы об адекватности модели в целом.

* Упражнение 3.

Выведите отдельно информацию о:

- коэффициентах модели;
- общих характеристиках модели, умещающихся в одну строку;
- коэффициентах модели с учётом поправки на гетероскедастичность.

```{r}
___(___)
___(___)
___(___, vcov. = ___)
```

* Упражнение 4.

Визуализируйте линию регрессии для модели `model_r`.

```{r}
ggplot(data = ___, aes(x = ___, y = ___)) +
  geom_point(alpha = 0.2) +
  stat_smooth(method = ___)
```

- Попробуйте поменять значение параметра `alpha`.
За что он отвечает?

* Упражнение 5.

Постройте модель с новыми регрессорами.
Помимо доходов семьи `income`, включите возраст `age`, количество лет обучения `education`, индикатор для расы `nonwhite` и для наличия ипотеки `mortgage`.

```{r}
model_ur <- ___(data = ___, ___ ~ ___ + ___ + ___ + ___ + ___)
summary(___)
```

- Каким получился $R^2$ в новой модели?
- Все ли коэффициенты оказались значимыми на 5\%-ом уровне?

* Упражнение 6.

Постройте 90\%-ые доверительные интервалы для всех коэффициентов модели `model_ur` с учётом поправки на гетероскедастичность и визуализируйте результат.

Подсказка: чтобы поправка на гетероскедастичность отразилась на графике, нужно указать тип корректировки в аргументе `se`.

```{r}
coefci(___, vcov. = ___, type = ___, level = ___)
plot_model(___, ___ = 0.9, se = ___)
```

* Упражнение 7.

Проведите тест Вальда для моделей `model_r` и `model_ur`, используя корректировку на гетероскедастичность.

```{r}
___(___, ___, ___ = vcovHC)
```

- Какую модель следует предпочесть?

* Упражнение 8.

С помощью регрессий постройте доверительные интервалы для математического ожидания дохода семьи и для разности математических ожиданий доходов семей с ипотекой и без.

```{r}
model_mu <- lm(___)
coefci(___)

model_diff <- lm(___, ___ ~ ___)
___
```

* Упражнение 9.

С помощью регрессии проверьте, что наличие ипотеки и раса не влияют на доход семьи.

```{r}
model_2anova <- ___(data = work, ___ ~ ___ * ___)
summary(___)
anova_stats(___)
```

* Упражнение 10.

Для упражнений про инструментальные переменные будем использовать встроенный набор данных `CollegeDistance` из пакета `AER`.
Посмотрите на эти данные и их описательные статистики.

```{r}
data("CollegeDistance")
college <- CollegeDistance
skim(___)
glimpse(___)
```

Постройте обычную регрессию зарплаты `wage` на количество лет обучения `education`, этническую принадлежность `ethnicity`, пол  `gender` и доход семьи `income`.

```{r}
model_ols <- lm(data = college, ___)
summary(___)
```

- Что не так в этой модели?

* Упражнение 11.

Постройте 2МНК регрессию, используя в качестве инструмента для переменной `education` расстояние до колледжа `distance`.

```{r}
model_iv <- ivreg(___,  ___ ~ education + ethnicity + gender + income | ____)
summary(___, ___ = TRUE)
```

- Как можно проинтерпретировать коэффициент при переменной `education`?
